name: Continuous Integration
on:
    push:
    schedule:
        - cron: '00 09 * * *'
jobs:
    continuous_integration:
        name: Continuous Integration
        permissions:
            actions: read
            contents: read
            security-events: write
        strategy:
            fail-fast: false
            matrix:
                language: [ 'python' ]
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v3
            - name: Setup Worker
              run: ci/scripts/setup_worker.sh
            - name: Perform Static Codescan Checks
              run: ci/scripts/codescan.sh
            - name: Initialize Runtime Code Analysis
              uses: github/codeql-action/init@v2
              with:
                  languages: ${{ matrix.language }}
            - name: Perform Runtime Code Analysis
              uses: github/codeql-action/analyze@v2
            - name: Perfom Secure Code Analysis (Vulnerabilities)
              uses: snyk/actions/python@master
              env:
                  SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
              with:
                  command: test
            - name: Perform Secure Code Analysis (Secrets)
              uses: trufflesecurity/trufflehog@main
              with:
                  path: ./
                  base: ${{ github.ref_name }}
                  head: HEAD
            - name: Run Unit Tests
              run: ci/scripts/test_runner.sh